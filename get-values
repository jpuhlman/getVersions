#!/bin/bash

set -e
DEBUG="0"
if [ "$1" == "-d" ] ; then 
	DEBUG="1"
        shift
fi
if [ -z "$1" ] ; then
   echo "Need uri of shar script"
   exit 1
else
   URI=$1
fi
if [ "$DEBUG" == "1" ] ; then
   set -x
fi
FN=$(basename $URI)
echo Installer: $FN
wget $URI -O /out/$FN >/out/log 2>&1
if [ $? -ne 0 ] ; then
   cat /out/log
   exit 1
fi
chmod 755 /out/$FN
yes | /out/$FN -nogui -e /out/foo -l /out/montavista  >/out/log 2>&1
if [ $? -ne 0 ] ; then
   cat /out/log
   exit 1
fi
/lice-kill /out/montavista/ 2>/dev/null || true
/getVersioning /out/montavista/
rm /out/* -rf

